<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Logo Preview Editor</title>
<style>
body {
    background: #f8f9fa;
    font-family: 'Segoe UI', sans-serif;
    margin: 0;
    padding: 0;
}
header {
    background: #007bff;
    color: white;
    padding: 20px;
    text-align: center;
}
.batch-selector {
    margin: 20px auto;
    display: flex;
    justify-content: center;
    gap: 10px;
}
.batch-selector select {
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 15px;
}
.grid {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
    padding: 20px;
}
.logo-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    width: 180px;
    text-align: center;
    transition: transform 0.2s;
}
.logo-card:hover { transform: translateY(-4px); }
.logo-item {
    height: 120px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border-bottom: 1px solid #eee;
}
.logo-item img {
    max-height: 100px;
    max-width: 140px;
    object-fit: contain;
}
.filename {
    padding: 10px;
    font-size: 14px;
    color: #333;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
</style>
</head>
<body>
<header>
  <h2>Logo Preview Editor</h2>
</header>

<div class="batch-selector">
  <label for="batch">Select Batch:</label>
  <select id="batch" onchange="loadBatch(this.value)">
    <option value='batch_54_logos'>batch_54_logos</option>
  </select>
</div>

<div id="logoGrid" class="grid"></div>
<input type="file" id="fileInput" style="display:none" accept="image/*" />

<script>
async function loadBatch(batchName) {
    const res = await fetch(`/list/${batchName}`);
    const files = await res.json();
    const grid = document.getElementById('logoGrid');
    grid.innerHTML = '';

    if (!files.length) {
        grid.innerHTML = '<p>No logos found in this batch.</p>';
        return;
    }

    files.forEach(f => {
        const card = document.createElement('div');
        card.className = 'logo-card';
        card.innerHTML = `
            <div class="logo-item" onclick="uploadLogo('${batchName}','${f}', this)">
                <img src="/logos/${batchName}/${f}" alt="${f}">
            </div>
            <div class="filename">${f}</div>
        `;
        grid.appendChild(card);
    });
}

function uploadLogo(batchName, filename, element) {
    const input = document.getElementById('fileInput');
    input.onchange = function(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            const base64 = e.target.result;
            const img = document.createElement('img');
            img.src = base64;
            element.innerHTML = '';
            element.appendChild(img);

            const nameDiv = element.nextElementSibling;
            if (nameDiv) nameDiv.textContent = file.name;

            fetch('/upload', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    batch: batchName,
                    filename: file.name,
                    image: base64
                })
            })
            .then(res => res.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('✅ Saved: ' + data.saved);
                } else {
                    alert('❌ Failed: ' + data.message);
                }
            })
            .catch(err => alert('⚠️ Error: ' + err));
        };
        reader.readAsDataURL(file);
    };
    input.click();
}

document.addEventListener('DOMContentLoaded', () => {
    const first = document.getElementById('batch').value;
    loadBatch(first);
});
</script>
</body>
</html>